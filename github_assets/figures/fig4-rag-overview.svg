<svg xmlns="http://www.w3.org/2000/svg" width="1050" height="1400" viewBox="0 0 1050 1400">
  <defs>
    <style>
      .title { font-family: 'Inter', 'Arial', sans-serif; font-size: 20px; font-weight: 600; fill: #343a40; }
      .step-title { font-family: 'Inter', 'Arial', sans-serif; font-size: 16px; font-weight: 700; fill: #343a40; }
      .step-desc { font-family: 'Inter', 'Arial', sans-serif; font-size: 13px; fill: #6c757d; }
      .step-details { font-family: 'Inter', 'Arial', sans-serif; font-size: 11px; fill: #6c757d; font-style: italic; }
      .data-label { font-family: 'Inter', 'Arial', sans-serif; font-size: 11px; font-weight: 600; fill: #495057; }
      .data-content { font-family: 'Consolas', 'Monaco', monospace; font-size: 10px; fill: #6c757d; }
      .data-highlight { font-family: 'Consolas', 'Monaco', monospace; font-size: 10px; font-weight: 600; fill: white; }
      .annotation-title { font-family: 'Inter', 'Arial', sans-serif; font-size: 10px; font-weight: 600; fill: #495057; }
      .annotation-text { font-family: 'Inter', 'Arial', sans-serif; font-size: 9px; fill: #6c757d; }
      .step-input { fill: #e3f2fd; stroke: #17a2b8; stroke-width: 3; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.1)); }
      .step-embedding { fill: #e8f5e9; stroke: #28a745; stroke-width: 3; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.1)); }
      .step-retrieval { fill: #fff3e0; stroke: #ff9800; stroke-width: 3; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.1)); }
      .step-augmentation { fill: #f3e5f5; stroke: #667eea; stroke-width: 3; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.1)); }
      .step-generation { fill: #cce7ff; stroke: #007bff; stroke-width: 3; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.1)); }
      .data-box { fill: rgba(255,255,255,0.9); stroke: #dee2e6; stroke-width: 1; }
      .annotation-box { fill: #f8f9fa; stroke: #007bff; stroke-width: 2; }
      .arrow { stroke: #007bff; stroke-width: 3; fill: none; marker-end: url(#arrowhead); }
      .vector-item { fill: #28a745; opacity: 0.7; }
      .vector-highlight { fill: #ffc107; opacity: 1; }
    </style>
    <marker id="arrowhead" markerWidth="12" markerHeight="9" refX="11" refY="4.5" orient="auto">
      <polygon points="0 0, 12 4.5, 0 9" fill="#007bff"/>
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="525" y="30" text-anchor="middle" class="title">Retrieval-Augmented Generation (RAG) Mechanism</text>
  
  <!-- Step 1: User Query Input -->
  <rect x="50" y="80" width="950" height="140" rx="12" class="step-input"/>
  <text x="80" y="110" style="font-size: 36px;">üìù</text>
  <text x="140" y="110" class="step-title">1. User Query Input</text>
  <text x="140" y="135" class="step-desc">Natural language query describing the desired TLF</text>
  <text x="140" y="155" class="step-details">Domain detection ‚Ä¢ Complexity assessment ‚Ä¢ Intent parsing</text>

  <!-- Data box for Step 1 - Better organized -->
  <rect x="140" y="170" width="500" height="40" rx="8" class="data-box"/>
  <text x="160" y="185" class="data-label">Example Query:</text>
  <text x="160" y="200" class="data-content">"Generate a <tspan fill="#ff9800" font-weight="600">demographics table</tspan> showing baseline characteristics</text>
  <text x="160" y="210" class="data-content">by treatment group with <tspan fill="#ff9800" font-weight="600">statistical tests</tspan>"</text>

  <!-- Annotation for Step 1 - Better positioned -->
  <rect x="680" y="170" width="140" height="40" rx="6" class="annotation-box"/>
  <text x="690" y="185" class="annotation-title">NLP Processing Results:</text>
  <text x="690" y="195" class="annotation-text">Domain: Demographics | Complexity: Medium</text>
  <text x="690" y="205" class="annotation-text">Intent: Table Generation | Dataset: ADSL</text>
  
  <!-- Arrow 1 -->
  <path d="M 525 240 L 525 280" class="arrow"/>
  
  <!-- Step 2: Query Embedding Generation -->
  <rect x="50" y="280" width="950" height="120" rx="12" class="step-embedding"/>
  <text x="80" y="305" style="font-size: 36px;">üß†</text>
  <text x="140" y="305" class="step-title">2. Query Embedding Generation</text>
  <text x="140" y="325" class="step-desc">Convert query to high-dimensional vector representation</text>
  <text x="140" y="345" class="step-details">Local embedding model ‚Ä¢ 768-dimensional vectors ‚Ä¢ Semantic encoding</text>
  
  <!-- Data box for Step 2 -->
  <rect x="550" y="300" width="400" height="80" rx="8" class="data-box"/>
  <text x="570" y="320" class="data-label">Embedding Vector:</text>
  <text x="570" y="335" class="data-content">[0.23, -0.45, 0.67, 0.12, ...]</text>
  <rect x="650" y="342" width="80" height="12" fill="#ffc107" rx="2"/>
  <text x="655" y="351" class="data-highlight">768 dimensions</text>
  <text x="570" y="365" class="data-content">Cosine similarity ready</text>
  
  <!-- Vector visualization -->
  <rect x="800" y="310" width="8" height="4" class="vector-item"/>
  <rect x="812" y="310" width="8" height="4" class="vector-highlight"/>
  <rect x="824" y="310" width="8" height="4" class="vector-item"/>
  <rect x="836" y="310" width="8" height="4" class="vector-highlight"/>
  <rect x="848" y="310" width="8" height="4" class="vector-item"/>
  <rect x="860" y="310" width="8" height="4" class="vector-item"/>
  <rect x="872" y="310" width="8" height="4" class="vector-highlight"/>
  <rect x="884" y="310" width="8" height="4" class="vector-item"/>
  
  <!-- Annotation for Step 2 -->
  <rect x="750" y="250" width="120" height="60" rx="6" class="annotation-box"/>
  <text x="760" y="265" class="annotation-title">Vector Space</text>
  <text x="760" y="278" class="annotation-text">Semantic similarity</text>
  <text x="760" y="288" class="annotation-text">Context preservation</text>
  <text x="760" y="298" class="annotation-text">Domain clustering</text>
  
  <!-- Arrow 2 -->
  <path d="M 525 420 L 525 460" class="arrow"/>
  
  <!-- Step 3: Similar Template Retrieval -->
  <rect x="50" y="480" width="950" height="120" rx="12" class="step-retrieval"/>
  <text x="80" y="505" style="font-size: 36px;">üîç</text>
  <text x="140" y="505" class="step-title">3. Similar Template Retrieval</text>
  <text x="140" y="525" class="step-desc">Search vector database for most relevant templates</text>
  <text x="140" y="545" class="step-details">Cosine similarity ‚Ä¢ Top-K retrieval ‚Ä¢ FDA-compliant templates</text>
  
  <!-- Data box for Step 3 -->
  <rect x="550" y="500" width="400" height="80" rx="8" class="data-box"/>
  <text x="570" y="520" class="data-label">Retrieved Templates:</text>
  <text x="570" y="535" class="data-content">1. Demographics_Table_v2.3</text>
  <rect x="720" y="527" width="80" height="12" fill="#ffc107" rx="2"/>
  <text x="725" y="536" class="data-highlight">Similarity: 0.94</text>
  <text x="570" y="550" class="data-content">2. Baseline_Characteristics.tlf</text>
  <rect x="720" y="542" width="80" height="12" fill="#ffc107" rx="2"/>
  <text x="725" y="551" class="data-highlight">Similarity: 0.89</text>
  <text x="570" y="565" class="data-content">3. Subject_Summary_Table.R</text>
  <rect x="720" y="557" width="80" height="12" fill="#ffc107" rx="2"/>
  <text x="725" y="566" class="data-highlight">Similarity: 0.85</text>
  
  <!-- Annotation for Step 3 -->
  <rect x="750" y="450" width="120" height="60" rx="6" class="annotation-box"/>
  <text x="760" y="465" class="annotation-title">Vector DB</text>
  <text x="760" y="478" class="annotation-text">234 templates indexed</text>
  <text x="760" y="488" class="annotation-text">FDA compliance verified</text>
  <text x="760" y="498" class="annotation-text">Multi-domain coverage</text>
  
  <!-- Arrow 3 -->
  <path d="M 525 620 L 525 660" class="arrow"/>
  
  <!-- Step 4: Context Augmentation -->
  <rect x="50" y="680" width="950" height="120" rx="12" class="step-augmentation"/>
  <text x="80" y="705" style="font-size: 36px;">üîß</text>
  <text x="140" y="705" class="step-title">4. Context Augmentation</text>
  <text x="140" y="725" class="step-desc">Combine query with retrieved templates and metadata</text>
  <text x="140" y="745" class="step-details">Template analysis ‚Ä¢ Regulatory context ‚Ä¢ Best practices integration</text>
  
  <!-- Data box for Step 4 -->
  <rect x="550" y="700" width="400" height="80" rx="8" class="data-box"/>
  <text x="570" y="720" class="data-label">Augmented Context:</text>
  <text x="570" y="735" class="data-content">Original Query +</text>
  <rect x="570" y="742" width="100" height="12" fill="#ffc107" rx="2"/>
  <text x="575" y="751" class="data-highlight">Template Structure</text>
  <text x="675" y="750" class="data-content"> +</text>
  <rect x="570" y="757" width="80" height="12" fill="#ffc107" rx="2"/>
  <text x="575" y="766" class="data-highlight">FDA Guidelines</text>
  <text x="655" y="765" class="data-content"> +</text>
  <rect x="570" y="772" width="100" height="12" fill="#ffc107" rx="2"/>
  <text x="575" y="781" class="data-highlight">Variable Mappings</text>
  
  <!-- Annotation for Step 4 -->
  <rect x="750" y="650" width="120" height="60" rx="6" class="annotation-box"/>
  <text x="760" y="665" class="annotation-title">Context Enrichment</text>
  <text x="760" y="678" class="annotation-text">Regulatory compliance</text>
  <text x="760" y="688" class="annotation-text">Best practices</text>
  <text x="760" y="698" class="annotation-text">Domain expertise</text>
  
  <!-- Arrow 4 -->
  <path d="M 525 820 L 525 860" class="arrow"/>
  
  <!-- Step 5: Enhanced LLM Generation -->
  <rect x="50" y="880" width="950" height="120" rx="12" class="step-generation"/>
  <text x="80" y="905" style="font-size: 36px;">‚ö°</text>
  <text x="140" y="905" class="step-title">5. Enhanced LLM Generation</text>
  <text x="140" y="925" class="step-desc">Generate high-quality output using enriched context</text>
  <text x="140" y="945" class="step-details">Multi-provider LLM ‚Ä¢ Context-aware generation ‚Ä¢ Quality validation</text>
  
  <!-- Data box for Step 5 -->
  <rect x="550" y="900" width="400" height="80" rx="8" class="data-box"/>
  <text x="570" y="920" class="data-label">Generated Output:</text>
  <rect x="570" y="927" width="80" height="12" fill="#ffc107" rx="2"/>
  <text x="575" y="936" class="data-highlight">Mock Template</text>
  <text x="570" y="950" class="data-content">‚úì FDA compliant structure</text>
  <text x="570" y="965" class="data-content">‚úì Professional formatting</text>
  <text x="570" y="980" class="data-content">‚úì Statistical annotations</text>
  
  <!-- Annotation for Step 5 -->
  <rect x="750" y="850" width="120" height="60" rx="6" class="annotation-box"/>
  <text x="760" y="865" class="annotation-title">Quality Assurance</text>
  <text x="760" y="878" class="annotation-text">Template validation</text>
  <text x="760" y="888" class="annotation-text">Compliance checking</text>
  <text x="760" y="898" class="annotation-text">Professional formatting</text>
  
  <!-- Benefits Section -->
  <rect x="50" y="1050" width="950" height="120" rx="12" fill="#f8f9fa" stroke="#28a745" stroke-width="2" stroke-dasharray="5,5"/>
  <text x="525" y="1080" text-anchor="middle" class="step-title" fill="#28a745">RAG System Benefits</text>
  
  <text x="100" y="1105" class="step-desc">‚úì <tspan font-weight="600">Contextual Accuracy:</tspan> Leverages existing FDA-compliant templates</text>
  <text x="100" y="1125" class="step-desc">‚úì <tspan font-weight="600">Domain Expertise:</tspan> Incorporates clinical trial best practices</text>
  <text x="100" y="1145" class="step-desc">‚úì <tspan font-weight="600">Quality Assurance:</tspan> Regulatory compliance validation</text>
  <text x="100" y="1165" class="step-desc">‚úì <tspan font-weight="600">Continuous Learning:</tspan> Template database grows with usage</text>
  
  <!-- Performance Metrics -->
  <rect x="50" y="1220" width="950" height="100" rx="12" fill="#e3f2fd" stroke="#007bff" stroke-width="2"/>
  <text x="525" y="1250" text-anchor="middle" class="step-title" fill="#007bff">RAG Performance Metrics</text>
  
  <text x="150" y="1275" text-anchor="middle" class="data-label">Template Retrieval</text>
  <text x="150" y="1290" text-anchor="middle" class="step-desc" font-weight="600" fill="#007bff">94.2% Accuracy</text>
  
  <text x="350" y="1275" text-anchor="middle" class="data-label">Context Relevance</text>
  <text x="350" y="1290" text-anchor="middle" class="step-desc" font-weight="600" fill="#007bff">91.7% Score</text>
  
  <text x="550" y="1275" text-anchor="middle" class="data-label">Response Time</text>
  <text x="550" y="1290" text-anchor="middle" class="step-desc" font-weight="600" fill="#007bff">&lt; 2.3 seconds</text>
  
  <text x="750" y="1275" text-anchor="middle" class="data-label">FDA Compliance</text>
  <text x="750" y="1290" text-anchor="middle" class="step-desc" font-weight="600" fill="#007bff">98.5% Rate</text>
  
</svg>
